#!/usr/bin/env bash

llvm_path="/usr/local/llvm/bin"

rm -rf build
#sudo rm -rf /usr/local/llvm-dev/*

cmake -G "Ninja" -S llvm -B build -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DCMAKE_BUILD_TYPE=RelWithDebInfo \
-DCMAKE_C_COMPILER=$llvm_path/clang -DCMAKE_CXX_COMPILER=$llvm_path/clang++ -DLLVM_USE_LINKER=mold \
-DLLVM_BINUTILS_INCDIR=/usr/include -DBUILD_SHARED_LIBS=ON -DLLVM_ENABLE_PROJECTS="clang;llvm" \
-DLLVM_PARALLEL_LINK_JOBS=2 -DLLVM_ENABLE_LTO=Thin -DLLVM_ENABLE_ZSTD=ON -DLLVM_CCACHE_BUILD=ON \
-DLLVM_ENABLE_ASSERTIONS=ON -DCMAKE_INSTALL_PREFIX=/usr/local/llvm-dev

#cd build && time (ninja && ninja check-all && sudo ninja install)
cd build && time (ninja && ninja check-all)
