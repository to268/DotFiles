#!/usr/bin/env bash

doas rm -rf "/usr/local/obs-studio/*"
mkdir obs-build
cd obs-build

wget https://cdn-fastly.obsproject.com/downloads/cef_binary_4638_linux64.tar.bz2
tar -xjf ./cef_binary_4638_linux64.tar.bz2
git clone --recursive https://github.com/obsproject/obs-studio.git

cd obs-studio

cmake -S . -B build -G "Ninja" -DUNIX_STRUCTURE=1 -DCMAKE_INSTALL_PREFIX="/usr/local/obs-studio" \
-DBUILD_BROWSER=ON -DENABLE_JACK=ON -DENABLE_LIBFDK=ON -DENABLE_SNDIO=ON \
-DENABLE_PIPEWIRE=OFF -DENABLE_VLC=OFF -DENABLE_AJA=OFF -DCMAKE_BUILD_TYPE=Release \
-DCEF_ROOT_DIR="${HOME}/obs-build/cef_binary_4638_linux64"

cd build
ninja && doas ninja install
rm -rf "${HOME}/obs-build"
